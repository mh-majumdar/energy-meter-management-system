{% extends "base.html" %} {% block content %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Energy Usage History</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        padding: 20px;
      }

      .my-container {
        max-width: 1200px;
        margin: 0 auto;
        background: rgba(255, 255, 255, 0.95);
        border-radius: 20px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        overflow: hidden;
        backdrop-filter: blur(10px);
      }

      .header {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        color: white;
        padding: 30px;
        text-align: center;
        position: relative;
        overflow: hidden;
      }

      .header::before {
        content: "";
        position: absolute;
        top: -50%;
        left: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(
          circle,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 70%
        );
        animation: pulse 4s ease-in-out infinite;
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 0.5;
        }
        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
      }

      .header h1 {
        font-size: 2.5rem;
        margin-bottom: 10px;
        position: relative;
        z-index: 1;
      }

      .header p {
        font-size: 1.1rem;
        opacity: 0.9;
        position: relative;
        z-index: 1;
      }

      .stats-bar {
        display: flex;
        justify-content: space-around;
        padding: 20px;
        background: rgba(52, 152, 219, 0.1);
        border-bottom: 1px solid rgba(52, 152, 219, 0.2);
      }

      .stat-item {
        text-align: center;
        padding: 15px;
        border-radius: 10px;
        background: white;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .stat-item:hover {
        transform: translateY(-5px);
      }

      .stat-value {
        font-size: 1.8rem;
        font-weight: bold;
        color: #2c3e50;
      }

      .stat-label {
        font-size: 0.9rem;
        color: #7f8c8d;
        margin-top: 5px;
      }

      .accordion-container {
        padding: 30px;
      }

      .accordion-item {
        margin-bottom: 20px;
        border-radius: 15px;
        overflow: hidden;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
      }

      .accordion-item:hover {
        box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      }

      .accordion-header {
        background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        color: white;
        padding: 20px;
        cursor: pointer;
        position: relative;
        transition: all 0.3s ease;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      .accordion-header:hover {
        background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
      }

      .accordion-header.active {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
      }

      .accordion-title {
        font-size: 1.3rem;
        font-weight: 600;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .accordion-icon {
        font-size: 1.5rem;
        transition: transform 0.3s ease;
      }

      .accordion-header.active .accordion-icon {
        transform: rotate(180deg);
      }

      .accordion-content {
        max-height: 0;
        overflow: hidden;
        background: white;
        transition: max-height 0.5s ease;
      }

      .accordion-content.active {
        max-height: 600px;
      }

      .chart-container {
        padding: 30px;
        position: relative;
      }

      .chart-wrapper {
        position: relative;
        height: 400px;
        margin: 20px 0;
      }

      .chart-info {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
        padding: 15px;
        background: rgba(52, 152, 219, 0.1);
        border-radius: 10px;
      }

      .chart-title {
        font-size: 1.2rem;
        font-weight: 600;
        color: #2c3e50;
      }

      .chart-period {
        font-size: 0.9rem;
        color: #7f8c8d;
        background: white;
        padding: 5px 15px;
        border-radius: 20px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .loading-spinner {
        display: none;
        text-align: center;
        padding: 50px;
      }

      .spinner {
        border: 4px solid #f3f3f3;
        border-top: 4px solid #3498db;
        border-radius: 50%;
        width: 40px;
        height: 40px;
        animation: spin 1s linear infinite;
        margin: 0 auto 20px;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .export-buttons {
        display: flex;
        gap: 10px;
        margin-top: 20px;
      }

      .export-btn {
        padding: 10px 20px;
        border: none;
        border-radius: 25px;
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
        cursor: pointer;
        transition: all 0.3s ease;
        font-weight: 600;
      }

      .export-btn:hover {
        background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        transform: translateY(-2px);
      }

      @media (max-width: 768px) {
        .stats-bar {
          flex-direction: column;
          gap: 15px;
        }

        .header h1 {
          font-size: 2rem;
        }

        .chart-info {
          flex-direction: column;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="my-container">
      <div class="header">
        <h1>‚ö° Energy Usage History</h1>
        <p>Track and analyze your electricity consumption patterns</p>
      </div>

      <div class="accordion-container">
        <div class="accordion-item">
          <div class="accordion-header" onclick="toggleAccordion(0)">
            <div class="accordion-title">üìä Daily Usage History</div>
            <div class="accordion-icon">‚ñº</div>
          </div>
          <div class="accordion-content">
            <div class="chart-container">
              <div class="chart-info">
                <div class="chart-title">Last 30 Days Energy Consumption</div>
                <div class="chart-period">Updated: Today</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="dailyChart"></canvas>
              </div>
              <div class="export-buttons">
                <button class="export-btn" onclick="exportChart('daily')">
                  üìä Export Data
                </button>
                <button class="export-btn" onclick="printChart('daily')">
                  üñ®Ô∏è Print Report
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <div class="accordion-header" onclick="toggleAccordion(1)">
            <div class="accordion-title">üìà Monthly Usage History</div>
            <div class="accordion-icon">‚ñº</div>
          </div>
          <div class="accordion-content">
            <div class="chart-container">
              <div class="chart-info">
                <div class="chart-title">Last 12 Months Energy Consumption</div>
                <div class="chart-period">Updated: Monthly</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="monthlyChart"></canvas>
              </div>
              <div class="export-buttons">
                <button class="export-btn" onclick="exportChart('monthly')">
                  üìä Export Data
                </button>
                <button class="export-btn" onclick="printChart('monthly')">
                  üñ®Ô∏è Print Report
                </button>
              </div>
            </div>
          </div>
        </div>

        <div class="accordion-item">
          <div class="accordion-header" onclick="toggleAccordion(2)">
            <div class="accordion-title">üìä Yearly Usage History</div>
            <div class="accordion-icon">‚ñº</div>
          </div>
          <div class="accordion-content">
            <div class="chart-container">
              <div class="chart-info">
                <div class="chart-title">Last 5 Years Energy Consumption</div>
                <div class="chart-period">Updated: Annually</div>
              </div>
              <div class="chart-wrapper">
                <canvas id="yearlyChart"></canvas>
              </div>
              <div class="export-buttons">
                <button class="export-btn" onclick="exportChart('yearly')">
                  üìä Export Data
                </button>
                <button class="export-btn" onclick="printChart('yearly')">
                  üñ®Ô∏è Print Report
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script>
      let charts = {};
      let currentActiveAccordion = null;

      // Generate dummy data
      function generateDailyData() {
        const days = [];
        const usage = [];
        const today = new Date();

        for (let i = 29; i >= 0; i--) {
          const date = new Date(today);
          date.setDate(date.getDate() - i);
          days.push(
            date.toLocaleDateString("en-US", { month: "short", day: "numeric" })
          );
          usage.push(Math.random() * 50 + 20); // Random usage between 20-70 kWh
        }

        return { days, usage };
      }

      function generateMonthlyData() {
        const months = [
          "Jan",
          "Feb",
          "Mar",
          "Apr",
          "May",
          "Jun",
          "Jul",
          "Aug",
          "Sep",
          "Oct",
          "Nov",
          "Dec",
        ];
        const usage = months.map(() => Math.random() * 800 + 400); // Random usage between 400-1200 kWh
        return { months, usage };
      }

      function generateYearlyData() {
        const years = ["2020", "2021", "2022", "2023", "2024"];
        const usage = years.map(() => Math.random() * 5000 + 8000); // Random usage between 8000-13000 kWh
        return { years, usage };
      }

      function createDailyChart() {
        const ctx = document.getElementById("dailyChart").getContext("2d");
        const data = generateDailyData();

        charts.daily = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.days,
            datasets: [
              {
                label: "Daily Usage (kWh)",
                data: data.usage,
                borderColor: "rgb(52, 152, 219)",
                backgroundColor: "rgba(52, 152, 219, 0.1)",
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "rgb(52, 152, 219)",
                pointBorderColor: "white",
                pointBorderWidth: 2,
                pointRadius: 5,
                pointHoverRadius: 8,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
                labels: {
                  usePointStyle: true,
                  font: {
                    size: 14,
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "white",
                bodyColor: "white",
                borderColor: "rgb(52, 152, 219)",
                borderWidth: 1,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Energy Usage (kWh)",
                  font: {
                    size: 14,
                  },
                },
                grid: {
                  color: "rgba(0, 0, 0, 0.1)",
                },
              },
              x: {
                title: {
                  display: true,
                  text: "Date",
                  font: {
                    size: 14,
                  },
                },
                grid: {
                  display: false,
                },
              },
            },
            elements: {
              point: {
                hoverBorderWidth: 3,
              },
            },
          },
        });
      }

      function createMonthlyChart() {
        const ctx = document.getElementById("monthlyChart").getContext("2d");
        const data = generateMonthlyData();

        charts.monthly = new Chart(ctx, {
          type: "line",
          data: {
            labels: data.months,
            datasets: [
              {
                label: "Monthly Usage (kWh)",
                data: data.usage,
                borderColor: "rgb(46, 204, 113)",
                backgroundColor: "rgba(46, 204, 113, 0.1)",
                borderWidth: 3,
                fill: true,
                tension: 0.4,
                pointBackgroundColor: "rgb(46, 204, 113)",
                pointBorderColor: "white",
                pointBorderWidth: 2,
                pointRadius: 6,
                pointHoverRadius: 9,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
                labels: {
                  usePointStyle: true,
                  font: {
                    size: 14,
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "white",
                bodyColor: "white",
                borderColor: "rgb(46, 204, 113)",
                borderWidth: 1,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Energy Usage (kWh)",
                  font: {
                    size: 14,
                  },
                },
                grid: {
                  color: "rgba(0, 0, 0, 0.1)",
                },
              },
              x: {
                title: {
                  display: true,
                  text: "Month",
                  font: {
                    size: 14,
                  },
                },
                grid: {
                  display: false,
                },
              },
            },
          },
        });
      }

      function createYearlyChart() {
        const ctx = document.getElementById("yearlyChart").getContext("2d");
        const data = generateYearlyData();

        charts.yearly = new Chart(ctx, {
          type: "bar",
          data: {
            labels: data.years,
            datasets: [
              {
                label: "Yearly Usage (kWh)",
                data: data.usage,
                backgroundColor: [
                  "rgba(231, 76, 60, 0.8)",
                  "rgba(155, 89, 182, 0.8)",
                  "rgba(52, 152, 219, 0.8)",
                  "rgba(46, 204, 113, 0.8)",
                  "rgba(241, 196, 15, 0.8)",
                ],
                borderColor: [
                  "rgb(231, 76, 60)",
                  "rgb(155, 89, 182)",
                  "rgb(52, 152, 219)",
                  "rgb(46, 204, 113)",
                  "rgb(241, 196, 15)",
                ],
                borderWidth: 2,
                borderRadius: 8,
                borderSkipped: false,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
              legend: {
                display: true,
                position: "top",
                labels: {
                  usePointStyle: true,
                  font: {
                    size: 14,
                  },
                },
              },
              tooltip: {
                backgroundColor: "rgba(0, 0, 0, 0.8)",
                titleColor: "white",
                bodyColor: "white",
                borderColor: "rgb(231, 76, 60)",
                borderWidth: 1,
              },
            },
            scales: {
              y: {
                beginAtZero: true,
                title: {
                  display: true,
                  text: "Energy Usage (kWh)",
                  font: {
                    size: 14,
                  },
                },
                grid: {
                  color: "rgba(0, 0, 0, 0.1)",
                },
              },
              x: {
                title: {
                  display: true,
                  text: "Year",
                  font: {
                    size: 14,
                  },
                },
                grid: {
                  display: false,
                },
              },
            },
          },
        });
      }

      function toggleAccordion(index) {
        const headers = document.querySelectorAll(".accordion-header");
        const contents = document.querySelectorAll(".accordion-content");

        // Close all others
        headers.forEach((header, i) => {
          if (i !== index) {
            header.classList.remove("active");
            contents[i].classList.remove("active");
          }
        });

        // Toggle current
        headers[index].classList.toggle("active");
        contents[index].classList.toggle("active");

        // Create chart if opening and not already created
        if (contents[index].classList.contains("active")) {
          setTimeout(() => {
            if (index === 0 && !charts.daily) {
              createDailyChart();
            } else if (index === 1 && !charts.monthly) {
              createMonthlyChart();
            } else if (index === 2 && !charts.yearly) {
              createYearlyChart();
            }
          }, 300);
        }
      }

      function exportChart(type) {
        if (charts[type]) {
          const link = document.createElement("a");
          link.download = `${type}-energy-usage.png`;
          link.href = charts[type].toBase64Image();
          link.click();
        }
      }

      function printChart(type) {
        if (charts[type]) {
          const printWindow = window.open("", "_blank");
          printWindow.document.write(`
                    <html>
                        <head>
                            <title>${
                              type.charAt(0).toUpperCase() + type.slice(1)
                            } Energy Usage Report</title>
                            <style>
                                body { font-family: Arial, sans-serif; margin: 20px; }
                                h1 { color: #2c3e50; }
                                img { max-width: 100%; height: auto; }
                            </style>
                        </head>
                        <body>
                            <h1>${
                              type.charAt(0).toUpperCase() + type.slice(1)
                            } Energy Usage Report</h1>
                            <p>Generated on: ${new Date().toLocaleDateString()}</p>
                            <img src="${charts[
                              type
                            ].toBase64Image()}" alt="${type} chart">
                        </body>
                    </html>
                `);
          printWindow.document.close();
          printWindow.print();
        }
      }

      // Initialize first accordion item as open
      document.addEventListener("DOMContentLoaded", function () {
        setTimeout(() => {
          toggleAccordion(0);
        }, 500);
      });
    </script>
  </body>
</html>
{% endblock %}
