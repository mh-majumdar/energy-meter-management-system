{% extends "base.html" %} {% block content %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='complain.css') }}"
/>

<!-- Complaint Form Section -->
<div class="container my-5">
  <div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">
      <div class="header-banner text-center mb-4">
        <h2 class="mb-0">Submit a Complaint</h2>
        <p class="mt-2 text-muted">We're here to help resolve your concerns</p>
      </div>

      <!-- Flash Messages -->
      {% with messages = get_flashed_messages(with_categories=true) %} {% if
      messages %} {% for category, message in messages %}
      <div
        class="alert alert-{{ 'success' if category == 'success' else 'danger' }} alert-dismissible fade show"
        role="alert"
      >
        {{ message }}
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="alert"
          aria-label="Close"
        ></button>
      </div>
      {% endfor %} {% endif %} {% endwith %}

      <!-- Complaint Form -->
      <div class="feature-card p-4">
        <form method="POST" enctype="multipart/form-data" id="complaintForm">
          {{ form.hidden_tag() }}

          <!-- Title Field -->
          <div class="mb-4">
            <label for="title" class="form-label fw-bold"
              >Complaint Title <span class="text-danger">*</span></label
            >
            {{ form.title(class="form-control form-control-lg",
            placeholder="Enter a brief title for your complaint") }} {% if
            form.title.errors %}
            <div class="text-danger mt-1">
              {% for error in form.title.errors %}
              <small>{{ error }}</small>
              {% endfor %}
            </div>
            {% endif %}
          </div>

          <!-- Description Field -->
          <div class="mb-4">
            <label for="description" class="form-label fw-bold"
              >Description <span class="text-danger">*</span></label
            >
            {{ form.description(class="form-control", rows="6",
            placeholder="Please provide detailed information about your
            complaint...") }} {% if form.description.errors %}
            <div class="text-danger mt-1">
              {% for error in form.description.errors %}
              <small>{{ error }}</small>
              {% endfor %}
            </div>
            {% endif %}
            <div class="form-text">Minimum 20 characters required</div>
          </div>

          <!-- Image Upload Field -->
          <div class="mb-4">
            <label for="image" class="form-label fw-bold"
              >Attach Image (Optional)</label
            >
            <div class="input-group">
              {{ form.image(class="form-control", accept="image/*",
              id="imageInput") }}
              <label class="input-group-text" for="imageInput">
                <i class="fas fa-upload"></i> Choose File
              </label>
            </div>
            {% if form.image.errors %}
            <div class="text-danger mt-1">
              {% for error in form.image.errors %}
              <small>{{ error }}</small>
              {% endfor %}
            </div>
            {% endif %}
            <div class="form-text">
              Supported formats: JPG, PNG, GIF (Max 5MB)
            </div>

            <!-- Image Preview -->
            <div id="imagePreview" class="mt-3" style="display: none">
              <img
                id="previewImg"
                src=""
                alt="Preview"
                class="img-thumbnail"
                style="max-width: 200px; max-height: 200px"
              />
              <button
                type="button"
                class="btn btn-sm btn-outline-danger ms-2"
                id="removeImage"
              >
                Remove
              </button>
            </div>
          </div>

          <!-- Contact Information -->
          <div class="row mb-4">
            <div class="col-md-6">
              <label for="email" class="form-label fw-bold"
                >Email Address <span class="text-danger">*</span></label
              >
              {{ form.email(class="form-control",
              placeholder="your.email@example.com") }} {% if form.email.errors
              %}
              <div class="text-danger mt-1">
                {% for error in form.email.errors %}
                <small>{{ error }}</small>
                {% endfor %}
              </div>
              {% endif %}
            </div>
            <div class="col-md-6">
              <label for="phone" class="form-label fw-bold"
                >Phone Number (Optional)</label
              >
              {{ form.phone(class="form-control", placeholder="+880
              1xxx-xxxxxx") }} {% if form.phone.errors %}
              <div class="text-danger mt-1">
                {% for error in form.phone.errors %}
                <small>{{ error }}</small>
                {% endfor %}
              </div>
              {% endif %}
            </div>
          </div>

          <!-- Submit Button -->
          <div class="text-center">
            <button
              type="submit"
              class="action-button px-5 py-3"
              id="submitBtn"
            >
              <span id="submitText">SUBMIT COMPLAINT</span>
              <span
                id="submitSpinner"
                class="spinner-border spinner-border-sm ms-2"
                style="display: none"
              ></span>
            </button>
          </div>
        </form>
      </div>

      <!-- Contact Information -->
      
      </div>
    </div>
  </div>
</div>

<!-- Font Awesome for Icons -->
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
/>

<!-- JavaScript for Form Enhancement -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const imageInput = document.getElementById("imageInput");
    const imagePreview = document.getElementById("imagePreview");
    const previewImg = document.getElementById("previewImg");
    const removeImageBtn = document.getElementById("removeImage");
    const form = document.getElementById("complaintForm");
    const submitBtn = document.getElementById("submitBtn");
    const submitText = document.getElementById("submitText");
    const submitSpinner = document.getElementById("submitSpinner");

    // Image preview functionality
    imageInput.addEventListener("change", function (e) {
      const file = e.target.files[0];
      if (file) {
        // Validate file size (5MB limit)
        if (file.size > 5 * 1024 * 1024) {
          alert("File size must be less than 5MB");
          imageInput.value = "";
          return;
        }

        // Validate file type
        if (!file.type.startsWith("image/")) {
          alert("Please select a valid image file");
          imageInput.value = "";
          return;
        }

        const reader = new FileReader();
        reader.onload = function (e) {
          previewImg.src = e.target.result;
          imagePreview.style.display = "block";
        };
        reader.readAsDataURL(file);
      }
    });

    // Remove image functionality
    removeImageBtn.addEventListener("click", function () {
      imageInput.value = "";
      imagePreview.style.display = "none";
      previewImg.src = "";
    });

    // Form submission with loading state
    form.addEventListener("submit", function (e) {
      submitText.textContent = "SUBMITTING...";
      submitSpinner.style.display = "inline-block";
      submitBtn.disabled = true;
    });

    // Character counter for description
    const descriptionField = document.querySelector(
      'textarea[name="description"]'
    );
    const charCounter = document.createElement("div");
    charCounter.className = "form-text text-end";
    charCounter.id = "charCounter";
    descriptionField.parentNode.appendChild(charCounter);

    function updateCharCounter() {
      const length = descriptionField.value.length;
      charCounter.textContent = `${length} characters`;
      if (length < 20) {
        charCounter.className = "form-text text-end text-danger";
      } else {
        charCounter.className = "form-text text-end text-muted";
      }
    }

    descriptionField.addEventListener("input", updateCharCounter);
    updateCharCounter(); // Initial call
  });
</script>

<!-- Bootstrap Bundle with Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
{% endblock %}
